<table class="table table-hover table-xs m-0" [tooltip]="tooltip">
  <tbody>
  <tr class="d-flex" [style.backgroundColor]="permission !== 'parent' ? '#f2f2f2' : !isCollapsed ? '#dddddd' : ''">
    <td class="col">{{ position.pair }}</td>
    <td class="col">{{ OrderDirection[position.type.direction] }}</td>
    <td class="col">{{ position.amount | number }}</td>
    <td class="col">{{ position.open_price | number }}</td>
    <td class="col">{{ position.current_price | number }}</td>
    <td class="col">
      <button
        [disabled]="role !== ROLE.ADMIN"
        class="btn btn-xs btn-outline-danger"
        (click)="orderStop(tradingModal)"
      >ADD
      </button>
    </td>
    <td class="col">
      <button
        [disabled]="role !== ROLE.ADMIN"
        class="btn btn-xs btn-outline-warning"
        (click)="orderLimit(tradingModal)"
      >ADD
      </button>
    </td>
    <td class="col">{{ feeOrSwap | number }}</td>
    <td class="col">{{ position.pl | number }}</td>
    <td class="col">{{ position.plmain | number }}</td>
    <td class="col">{{ position.plmprc | number }}</td>
    <td class="col">{{ position.exposure | number }}</td>
    <td class="col">{{ position.open_order_time | date:'short' }}</td>
    <td class="col">
      <button
        [disabled]="role !== ROLE.ADMIN"
        class="btn btn-danger btn-xs"
        (click)="openModal(closeOrderModal, { class: 'modal-sm' })"
      >CLOSE
      </button>
    </td>
    <th class="col">
      <button
        [hidden]="permission !== PARENT || position.suborders === null"
        (click)="collapse()"
        [attr.aria-expanded]="!isCollapsed"
        class="btn btn-xs btn-primary">
        <fa-icon [icon]="isCollapsed ? faPlus : faMinus"></fa-icon>
      </button>
    </th>
  </tr>
  <tr [hidden]="isCollapsed" *ngIf="permission === PARENT">
    <th colspan="15" class="p-0">
      <table class="table table-hover table-xs m-0">
        <app-position
          *ngFor="let position of position.suborders"
          [position]="position"
          [accounts]="accounts"
        ></app-position>
      </table>
    </th>
  </tr>
  </tbody>
</table>

<ng-template #tradingModal>
  <div class="modal-header">
    <h3>{{ position.pair }}</h3>
  </div>
  <div class="modal-body">
    <tabset [justified]="true">
      <tab heading="Exchange">
        <form novalidate [formGroup]="exchangeForm" class="m-2">
          <div class="form-group">
            <label for="o_type" class="small">Exchange Type</label>
            <select class="form-control form-control-sm" id="o_type" formControlName="o_type">
              <option value="limit">Limit</option>
              <option value="market">Market</option>
              <option value="stop">Stop</option>
            </select>
          </div>
          <div class="form-row">
            <div class="form-group col">
              <label for="price" class="small">Price</label>
              <input
                id="price"
                [attr.disabled]="exchangeForm.value.o_type === 'market' ? '' : null"
                type="number"
                class="form-control form-control-sm"
                placeholder="Price"
                formControlName="price">
            </div>
            <div class="form-group col">
              <label for="amount" class="small">Amount</label>
              <input
                id="amount"
                type="number"
                class="form-control form-control-sm"
                placeholder="Amount"
                formControlName="amount">
            </div>
          </div>
          <div>
            <button
              [disabled]="role !== ROLE.ADMIN"
              type="submit"
              class="btn btn-success btn-xs"
              (click)="buyExchange(exchangeForm.value, exchangeForm.valid)"
            >BUY
            </button>
            <button
              [disabled]="role !== ROLE.ADMIN"
              type="submit"
              class="btn btn-danger float-right btn-xs"
              (click)="sellExchange(exchangeForm.value, exchangeForm.valid)"
            >SELL
            </button>
          </div>
        </form>
      </tab>

      <tab heading="Margin" [active]="true">
        <form novalidate [formGroup]="marginForm" class="m-2">
          <div class="form-group">
            <label for="o_type" class="small">Exchange Type</label>
            <select class="form-control form-control-sm" id="o_type" formControlName="o_type">
              <option value="limit">Limit</option>
              <option value="market">Market</option>
              <option value="stop">Stop</option>
            </select>
          </div>
          <div class="form-row">
            <div class="form-group col">
              <label for="price" class="small">Price</label>
              <input
                [attr.disabled]="marginForm.value.o_type === 'market' ? '' : null"
                id="price"
                type="number"
                class="form-control form-control-sm"
                placeholder="Price"
                formControlName="price">
            </div>
            <div class="form-group col">
              <label for="amount" class="small">Amount</label>
              <input
                id="amount"
                type="number"
                class="form-control form-control-sm"
                placeholder="Amount"
                formControlName="amount">
            </div>
          </div>
          <div>
            <button
              [disabled]="role !== ROLE.ADMIN"
              type="submit"
              class="btn btn-success btn-xs"
              (click)="buyMargin(marginForm.value, marginForm.valid)"
            >BUY
            </button>
            <button
              [disabled]="role !== ROLE.ADMIN"
              type="submit"
              class="btn btn-danger float-right btn-xs"
              (click)="sellMargin(marginForm.value, marginForm.valid)"
            >SELL
            </button>
          </div>
        </form>
      </tab>
    </tabset>
  </div>
</ng-template>

<ng-template #closeOrderModal>
  <div class="modal-body text-center">
    <p class="small">Do you want to close ?</p>
    <button type="button" class="btn btn-default btn-xs" (click)="orderClose()">Yes</button>
    <button type="button" class="btn btn-primary ml-1 btn-xs" (click)="modalRef.hide()">No</button>
  </div>
</ng-template>
