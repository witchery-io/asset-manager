<div class="container-fluid">
  <div class="row">
    <div class="col-3">
      <div class="row">
        <div class="col-6">
          <div class="mt-4">
            <div class="form-group">
              <select class="form-control form-control-sm" [ngModel]="selectedGroup" (change)="changeType('group', $event.target.value)">
                <option *ngFor="let group of groups" [value]="group.id">{{ group.name }}</option>
              </select>
            </div>
          </div>
        </div>
        <div class="col-6">
          <div class="mt-4">
            <div class="form-group">
              <select class="form-control form-control-sm" [ngModel]="selectedAccount"
                      (change)="changeType('account', $event.target.value)">
                <option *ngFor="let account of accounts" [value]="account.id">{{ account.user_name }}</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <div class="row">
    <div class="col-3 ticks-container mb-3">
      <!--<ng-table [config]="config"-->
      <!--[rows]="ticks" [columns]="columns">-->
      <!--</ng-table>-->
      <table class="table table-bordered table-xs">
        <thead>
        <tr>
          <th scope="col">Instrument</th>
          <th scope="col">Last</th>
          <th scope="col">24h%</th>
          <th scope="col">Vol USD</th>
          <th scope="col"></th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let tick of tickService.ticks; index as i">
          <td scope="row">{{ tick.pair }}</td>
          <td>{{ tick.last | number }}</td>
          <td [class.text-success]="tick.daily_change > 0" [class.text-danger]="tick.daily_change < 0">{{
            tick.daily_change * 100 | number }}
          </td>
          <td>{{ tick.volume | number }}</td>
          <td>
            <button [disabled]="accountService.role == 'guest'" class="btn btn-outline-warning btn-xs" (click)="tickSettings(tradingModal, i)">
              <fa-icon icon="plus"></fa-icon>
            </button>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
    <div class="col-9">
<!--      <highcharts-chart
        [Highcharts]="Highcharts"
        [options]="chartOptions"

        style="width: 100%; height: 400px; display: block;"
      ></highcharts-chart>-->
      <app-tv-chart

      ></app-tv-chart>

    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <app-order *ngIf="order" [order]="order" [type]="this.orderService.tradeType"></app-order>
    </div>
  </div>

  <app-status-bar [groups]="groups" [accounts]="accounts"></app-status-bar>
</div>

<ng-template #tradingModal class="modal-sm">
  <div class="modal-body">
    <div class="row">
      <div class="col-12">
        <h3>{{ tick.pair }}</h3>
      </div>
    </div>
    <div class="row">
      <div class="col-12">
        <tabset>
          <tab heading="Exchange">
            <form novalidate [formGroup]="exchangeForm" class="mt-3">
              <div class="form-group">
                <label for="exchange_o_type"></label>
                <select class="form-control" id="exchange_o_type" formControlName="o_type">
                  <option value="limit">Limit</option>
                  <option value="market">Market</option>
                  <option value="stop">Stop</option>
                </select>
              </div>

              <div class="form-row">
                <div class="form-group col">
                  <input
                    [attr.disabled]="exchangeForm.value.o_type === 'market' ? '' : null"
                    type="number"
                    class="form-control"
                    placeholder="Price"
                    formControlName="price"
                  >
                </div>
                <div class="form-group col">
                  <input type="number" class="form-control" placeholder="Amount" formControlName="amount">
                </div>
              </div>
              <div>
                <button type="submit" class="btn btn-success"
                        (click)="buyExchange(exchangeForm.value, exchangeForm.valid)">BUY
                </button>
                <button type="submit" class="btn btn-danger float-right"
                        (click)="sellExchange(exchangeForm.value, exchangeForm.valid)">SELL
                </button>
              </div>
            </form>
          </tab>

          <tab heading="Margin">
            <form novalidate [formGroup]="marginForm" class="mt-3">
              <div class="form-group">
                <label for="margin_o_type"></label>
                <select class="form-control" id="margin_o_type" formControlName="o_type">
                  <option value="limit">Limit</option>
                  <option value="market">Market</option>
                  <option value="stop">Stop</option>
                </select>
              </div>

              <div class="form-row">
                <div class="form-group col">
                  <input
                    [attr.disabled]="marginForm.value.o_type === 'market' ? '' : null"
                    type="number"
                    class="form-control"
                    placeholder="Price"
                    formControlName="price"
                  >
                </div>
                <div class="form-group col">
                  <input type="number" class="form-control" placeholder="Amount" formControlName="amount">
                </div>
              </div>

              <div>
                <button type="submit" class="btn btn-success" (click)="buyMargin(marginForm.value, marginForm.valid)">
                  BUY
                </button>
                <button type="submit" class="btn btn-danger float-right"
                        (click)="sellMargin(marginForm.value, marginForm.valid)">SELL
                </button>
              </div>
            </form>
          </tab>
        </tabset>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #confirmModal>
  <div class="modal-body text-center">
    <p>Do you want to confirm?</p>
    <button type="button" class="btn btn-default" (click)="confirm()" >Yes</button>
    <button type="button" class="btn btn-primary" (click)="decline()" >No</button>
  </div>
</ng-template>
