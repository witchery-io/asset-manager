<div class="container-fluid">
  <div class="row">
    <div class="col-2">
      <div class="mt-4">
        <div class="form-group">
          <select class="form-control" id="groups" [(ngModel)]="selectedGroup" (change)="changeType('group', $event.target.value)">
            <option *ngFor="let group of groups"
                    [value]="group.id"
                    [attr.selected]="group.id == currentTypeId ? true : null">
              {{ group.name }}
            </option>
          </select>
        </div>
      </div>
    </div>
    <div class="col-2">
      <div class="mt-4">
        <div class="form-group">
          <select class="form-control" id="accounts" [(ngModel)]="selectedAccount" (change)="changeType('account', $event.target.value)">
            <option *ngFor="let account of accounts"
                    [value]="account.id"
                    [attr.selected]="account.id == currentTypeId ? true : null">
              {{ account.user_name }}
            </option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-4 ticks-container mb-3">
      <!--<ng-table [config]="config"-->
                <!--[rows]="ticks" [columns]="columns">-->
      <!--</ng-table>-->
      <table class="table table-bordered table-sm">
        <thead>
        <tr>
          <th scope="col">Instrument</th>
          <th scope="col">Last</th>
          <th scope="col">24h%</th>
          <th scope="col">Vol USD</th>
          <th scope="col"></th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let tick of ticks; index as i">
          <td scope="row">{{ tick.pair }}</td>
          <td>{{ tick.last | number }}</td>
          <td [class.text-success]="tick.daily_change > 0" [class.text-danger]="tick.daily_change < 0">{{ tick.daily_change * 100 | number }}</td>
          <td>{{ tick.volume | number }}</td>
          <td>
            <button class="btn btn-outline-warning btn-sm" (click)="tickSettings(tradingModal, i)">
              <fa-icon icon="plus"></fa-icon>
            </button>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
    <div class="col-8">Candlestick</div>
  </div>

  <div class="row">
    <div class="col-12">
      <tabset>
        <tab heading="Positions" id="tab1">
          <table class="table table-bordered mt-3">
            <thead>
            <tr>
              <th scope="col">Instruments</th>
              <th scope="col">L/S</th>
              <th scope="col">Amount</th>
              <th scope="col">Open Price</th>
              <th scope="col">Market Price</th>
              <th scope="col">Stop</th>
              <th scope="col">Limit</th>
              <th scope="col">PL</th>
              <th scope="col">PL(BTC)</th>
              <th scope="col">PL %</th>
              <th scope="col">Exposure (BTC)</th>
            </tr>
            </thead>
            <tbody>
            <ng-container *ngFor="let o of orders">
                <tr>
                  <th scope="row">{{o.pair}}</th>
                  <td>{{o.type.direaction}}</td>
                  <td>3</td>
                  <td>4</td>
                  <td>5</td>
                  <td>6</td>
                  <td>7</td>
                  <td>8</td>
                  <td>9</td>
                  <td>10</td>
                  <td>11</td>
                </tr>
                <tr>
                  <td class="p-0" colspan="11">
                    <table class="table table-borderless border-white">
                      <thead>
                      <tr>
                        <th scope="col">Instruments</th>
                        <th scope="col">L/S</th>
                        <th scope="col">Amount</th>
                        <th scope="col">Open Price</th>
                        <th scope="col">Market Price</th>
                        <th scope="col">Stop</th>
                        <th scope="col">Limit</th>
                        <th scope="col">PL</th>
                        <th scope="col">PL(BTC)</th>
                        <th scope="col">PL %</th>
                        <th scope="col">Exposure (BTC)</th>
                      </tr>
                      </thead>
                      <tbody>
                      <ng-container *ngFor="let so of o.suborders">
                        <tr>
                          <th scope="row">1</th>
                          <td>2</td>
                          <td>3</td>
                          <td>4</td>
                          <td>5</td>
                          <td>6</td>
                          <td>7</td>
                          <td>8</td>
                          <td>9</td>
                          <td>10</td>
                          <td>11</td>
                        </tr>
                      </ng-container>
                      </tbody>
                    </table>
                  </td>
                </tr>
            </ng-container>
            </tbody>
          </table>
        </tab>
        <tab heading="Orders" id="tab2">
          <table class="table mt-3">
            <thead>
            <tr>
              <th scope="col">Instruments</th>
              <th scope="col">Context</th>
              <th scope="col">Type</th>
              <th scope="col">B/S</th>
              <th scope="col">Amount</th>
              <th scope="col">Price</th>
              <th scope="col">Duration</th>
              <th scope="col">Created</th>
            </tr>
            </thead>
            <tbody>
            <tr>
              <th scope="row">1</th>
              <td>2</td>
              <td>3</td>
              <td>4</td>
              <td>5</td>
              <td>6</td>
              <td>7</td>
              <td>8</td>
            </tr>
            </tbody>
          </table>
        </tab>
      </tabset>
    </div>
  </div>
</div>

<ng-template #tradingModal class="modal-sm">
  <div class="modal-body">
    <div class="row">
      <div class="col-12">
        <h3>{{ tick.pair }}</h3>
      </div>
    </div>
    <div class="row">
      <div class="col-12">
        <tabset>
          <tab heading="Exchange">
            <form novalidate [formGroup]="exchangeForm" class="mt-3">
              <div class="form-group">
                <label for="exchange_o_type"></label>
                <select class="form-control" id="exchange_o_type" formControlName="o_type">
                  <option value="limit">Limit</option>
                  <option value="market">Market</option>
                  <option value="stop">Stop</option>
                </select>
              </div>

              <div class="form-row">
                <div class="form-group col">
                  <input
                    [attr.disabled]="exchangeForm.value.o_type === 'market' ? '' : null"
                    type="number"
                    class="form-control"
                    placeholder="Price"
                    formControlName="price"
                  >
                </div>
                <div class="form-group col">
                  <input type="number" class="form-control" placeholder="Amount" formControlName="amount">
                </div>
              </div>
              <div>
                <button type="submit" class="btn btn-success" (click)="buyExchange(exchangeForm.value, exchangeForm.valid)">BUY</button>
                <button type="submit" class="btn btn-danger float-right" (click)="sellExchange(exchangeForm.value, exchangeForm.valid)">SELL</button>
              </div>
            </form>
          </tab>

          <tab heading="Margin">
            <form novalidate [formGroup]="marginForm" class="mt-3">
              <div class="form-group">
                <label for="margin_o_type"></label>
                <select class="form-control" id="margin_o_type" formControlName="o_type">
                  <option value="limit">Limit</option>
                  <option value="market">Market</option>
                  <option value="stop">Stop</option>
                </select>
              </div>

              <div class="form-row">
                <div class="form-group col">
                  <input
                    [attr.disabled]="marginForm.value.o_type === 'market' ? '' : null"
                    type="number"
                    class="form-control"
                    placeholder="Price"
                    formControlName="price"
                  >
                </div>
                <div class="form-group col">
                  <input type="number" class="form-control" placeholder="Amount" formControlName="amount">
                </div>
              </div>

              <div>
                <button type="submit" class="btn btn-success" (click)="buyMargin(marginForm.value, marginForm.valid)">BUY</button>
                <button type="submit" class="btn btn-danger float-right" (click)="sellMargin(marginForm.value, marginForm.valid)">SELL</button>
              </div>
            </form>
          </tab>
        </tabset>
      </div>
    </div>
  </div>
</ng-template>
